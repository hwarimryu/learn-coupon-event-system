![img.png](img.png)
- 기대한 쿠폰 개수와 다름
- 이유: race condition 때문
  - 쿠폰 개수가 99개 일때, 스레스 1이 쿠폰을 생성하기 전에 스레드2가 쿠폰 개수를 조회하면서 스레드 2도 쿠폰을 생성하면서 발생한 문제. 

<br>

### race condition
 두 개 이상의 스레드가 공유자원에 접근하고 작업을 할 때 결과가 달라질 수 있는 문제.

#### 1. 싱글스레드를 사용한다면?
=> 성능에 문제가 생긴다. 
- 10:01 1번 사용자 응모 
- 10:02 발급완료
  - 10:02 이후 2,3,4,...번 사용자 응모 가능해짐

#### 2. 자바의 synchronized 를 사용한다면?
=> 서버가 여러대가 된다면 race condition 이 다시 발생한다.

#### 3. mysql과 redis를 활용해 lock 을 구현하여 사용할 수 있다.
=> 성능에 좋지 않다. 쿠폰 발급만 lock을 걸고 싶은 건데, 발급된 쿠폰 개수를 가져오는 것 부터 lock 이 걸리기 때문이다.

#### 4. redis의 incr 명령어를 사용한다.
![img_1.png](img_1.png)
redis incr 명령어: key에 대한 value를 1씩 증가시킨다.   
=> redis는 싱글 스레드로 동작하고, 이 명령어는 성능도 빠르다.

![img_2.png](img_2.png)






